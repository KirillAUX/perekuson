<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - –ü–µ—Ä–µ–∫—É—Å–æ–Ω</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .warning { background: #fff3cd; }
        button { padding: 10px; margin: 5px; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üîß –û—Ç–ª–∞–¥–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>

    <div class="section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h2>
        <button onclick="checkAuthSystem()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å authSystem</button>
        <div id="authStatus"></div>
    </div>

    <div class="section">
        <h2>2. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
        <button onclick="createAdminUser()">–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
        <button onclick="createTestUsers()">–°–æ–∑–¥–∞—Ç—å –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
        <div id="userCreationStatus"></div>
    </div>

    <div class="section">
        <h2>3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—Ö–æ–¥</h2>
        <button onclick="forceLoginAsAdmin()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
        <button onclick="forceLoginAsUser()">–í–æ–π—Ç–∏ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</button>
        <div id="loginStatus"></div>
    </div>

    <div class="section">
        <h2>4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤</h2>
        <button onclick="checkAdminRights()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
        <div id="rightsStatus"></div>
    </div>

    <div class="section">
        <h2>5. –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
        <button onclick="clearAllData()" style="background: #ff6b6b;">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
        <div id="clearStatus"></div>
    </div>

    <div class="section">
        <h2>6. –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</h2>
        <button onclick="showCurrentState()">–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ</button>
        <pre id="currentState"></pre>
    </div>

    <script src="js/auth.js"></script>
    <script>
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ auth.js
        setTimeout(() => {
            if (typeof authSystem !== 'undefined') {
                document.getElementById('authStatus').innerHTML = 
                    '<div class="success">‚úÖ authSystem –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
            } else {
                document.getElementById('authStatus').innerHTML = 
                    '<div class="error">‚ùå authSystem –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
            }
        }, 1000);

        function checkAuthSystem() {
            const status = document.getElementById('authStatus');
            let html = '<h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ authSystem:</h3>';
            
            if (typeof authSystem === 'undefined') {
                html += '<div class="error">‚ùå authSystem –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω</div>';
                status.innerHTML = html;
                return;
            }

            html += `<div class="success">‚úÖ authSystem —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</div>`;
            html += `<pre>–ú–µ—Ç–æ–¥—ã: ${Object.keys(authSystem).join(', ')}</pre>`;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
            const methods = ['login', 'logout', 'isAuthenticated', 'isAdmin', 'getCurrentUser'];
            methods.forEach(method => {
                if (typeof authSystem[method] === 'function') {
                    html += `<div class="success">‚úÖ ${method}() –¥–æ—Å—Ç—É–ø–µ–Ω</div>`;
                } else {
                    html += `<div class="error">‚ùå ${method}() –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>`;
                }
            });

            status.innerHTML = html;
        }

        function createAdminUser() {
            const status = document.getElementById('userCreationStatus');
            
            if (typeof authSystem === 'undefined') {
                status.innerHTML = '<div class="error">‚ùå authSystem –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            const adminUser = {
                id: 1,
                username: 'admin',
                email: 'admin@perekuson.ru',
                password: 'admin123',
                role: 'admin',
                createdAt: new Date().toISOString()
            };

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–∏—Å—Ç–µ–º—É
            if (!authSystem.users) authSystem.users = [];
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            authSystem.users = authSystem.users.filter(u => u.role !== 'admin');
            authSystem.users.push(adminUser);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            if (typeof authSystem.saveUsers === 'function') {
                authSystem.saveUsers();
            } else {
                localStorage.setItem('users', JSON.stringify(authSystem.users));
            }

            status.innerHTML = `
                <div class="success">
                    ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω!<br>
                    –õ–æ–≥–∏–Ω: admin@perekuson.ru<br>
                    –ü–∞—Ä–æ–ª—å: admin123<br>
                    –†–æ–ª—å: admin
                </div>
                <pre>${JSON.stringify(adminUser, null, 2)}</pre>
            `;
        }

        function createTestUsers() {
            const status = document.getElementById('userCreationStatus');
            
            if (typeof authSystem === 'undefined') {
                status.innerHTML = '<div class="error">‚ùå authSystem –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
                return;
            }

            // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const testUsers = [
                {
                    id: 1,
                    username: 'admin',
                    email: 'admin@perekuson.ru',
                    password: 'admin123',
                    role: 'admin',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    username: 'user',
                    email: 'user@example.com',
                    password: 'password123',
                    role: 'user',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 3,
                    username: 'manager',
                    email: 'manager@perekuson.ru',
                    password: 'manager123',
                    role: 'manager',
                    createdAt: new Date().toISOString()
                }
            ];

            authSystem.users = testUsers;
            
            if (typeof authSystem.saveUsers === 'function') {
                authSystem.saveUsers();
            } else {
                localStorage.setItem('users', JSON.stringify(authSystem.users));
            }

            status.innerHTML = `
                <div class="success">
                    ‚úÖ –í—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã!
                </div>
                <pre>${JSON.stringify(testUsers, null, 2)}</pre>
            `;
        }

        function forceLoginAsAdmin() {
            const status = document.getElementById('loginStatus');
            
            if (typeof authSystem === 'undefined') {
                status.innerHTML = '<div class="error">‚ùå authSystem –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
                return;
            }

            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—Ö–æ–¥–∏–º –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
            const adminUser = {
                id: 1,
                username: 'admin',
                email: 'admin@perekuson.ru',
                password: 'admin123',
                role: 'admin',
                createdAt: new Date().toISOString()
            };

            authSystem.currentUser = adminUser;
            localStorage.setItem('currentUser', JSON.stringify(adminUser));

            // –û–±–Ω–æ–≤–ª—è–µ–º UI –µ—Å–ª–∏ –º–µ—Ç–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω
            if (typeof authSystem.updateUI === 'function') {
                authSystem.updateUI();
            }

            status.innerHTML = `
                <div class="success">
                    ‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—Ö–æ–¥ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω!<br>
                    <button onclick="checkAdminRights()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞</button>
                    <button onclick="location.href='index.html'">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</button>
                </div>
            `;
        }

        function forceLoginAsUser() {
            const status = document.getElementById('loginStatus');
            
            if (typeof authSystem === 'undefined') {
                status.innerHTML = '<div class="error">‚ùå authSystem –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
                return;
            }

            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—Ö–æ–¥–∏–º –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            const regularUser = {
                id: 2,
                username: 'user',
                email: 'user@example.com',
                password: 'password123',
                role: 'user',
                createdAt: new Date().toISOString()
            };

            authSystem.currentUser = regularUser;
            localStorage.setItem('currentUser', JSON.stringify(regularUser));

            if (typeof authSystem.updateUI === 'function') {
                authSystem.updateUI();
            }

            status.innerHTML = `
                <div class="success">
                    ‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—Ö–æ–¥ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω!<br>
                    <button onclick="checkAdminRights()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞</button>
                    <button onclick="location.href='index.html'">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</button>
                </div>
            `;
        }

        function checkAdminRights() {
            const status = document.getElementById('rightsStatus');
            
            if (typeof authSystem === 'undefined') {
                status.innerHTML = '<div class="error">‚ùå authSystem –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
                return;
            }

            let html = '<h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤:</h3>';
            
            const currentUser = authSystem.getCurrentUser ? authSystem.getCurrentUser() : authSystem.currentUser;
            html += `<div>–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${JSON.stringify(currentUser)}</div>`;
            
            const isAuth = authSystem.isAuthenticated ? authSystem.isAuthenticated() : !!currentUser;
            html += `<div>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω: ${isAuth ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</div>`;
            
            const isAdmin = authSystem.isAdmin ? authSystem.isAdmin() : (currentUser && currentUser.role === 'admin');
            html += `<div>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: ${isAdmin ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</div>`;

            status.innerHTML = html;
        }

        function clearAllData() {
            localStorage.clear();
            sessionStorage.clear();
            
            if (typeof authSystem !== 'undefined') {
                authSystem.users = [];
                authSystem.currentUser = null;
            }

            document.getElementById('clearStatus').innerHTML = `
                <div class="warning">
                    üßπ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã!<br>
                    –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.
                </div>
            `;
        }

        function showCurrentState() {
            const state = document.getElementById('currentState');
            
            const data = {
                localStorage: {
                    currentUser: localStorage.getItem('currentUser'),
                    users: localStorage.getItem('users')
                },
                authSystem: {
                    exists: typeof authSystem !== 'undefined',
                    currentUser: authSystem ? authSystem.currentUser : null,
                    users: authSystem ? authSystem.users : null,
                    methods: authSystem ? Object.keys(authSystem) : []
                }
            };

            state.textContent = JSON.stringify(data, null, 2);
        }
    </script>
</body>
</html>