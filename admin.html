<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#A63F00">
    <meta name="description" content="–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ü–µ—Ä–µ–∫—É—Å–æ–Ω - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ü–∏—è–º–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º">
    <meta name="keywords" content="–∞–¥–º–∏–Ω, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –∞–∫—Ü–∏–∏, –∫–æ–Ω—Ç–µ–Ω—Ç">
    <title>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - –ü–µ—Ä–µ–∫—É—Å–æ–Ω</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Preload –≤–∞–∂–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ -->
    <link rel="preload" href="js/auth.js" as="script">
    <link rel="preload" href="style.css" as="style">
</head>
<body>
    <!-- –û—Ñ—Ñ–ª–∞–π–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div id="offlineAlert" class="offline-alert" style="display: none;">
        <span>üì∂ –í—ã –≤ –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.</span>
        <button onclick="location.reload()" class="reload-btn">–û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>

    <header>
        <div class="head">
            <img class="img1" src="icon.png" alt="–ò–∫–æ–Ω–∫–∞ –ü–µ—Ä–µ–∫—É—Å–æ–Ω" loading="lazy" width="70" height="70">
            <span>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</span>
        </div>
        <div class="profile-dropdown">
            <button class="profile-btn initials-btn" id="profileBtn" aria-label="–ú–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è">üë§</button>
            <div class="dropdown-menu" id="dropdownMenu">
                <div class="menu-user">
                    <a href="profile.html" class="nav-link">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
                    <a href="index.html" class="nav-link">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                    <a href="#" class="da nav-link" onclick="logout()">üö™ –í—ã–π—Ç–∏</a>
                </div>
            </div>
        </div>
    </header>
    
    <nav>
        <a href="index.html" class="nav-button">üè† –ì–ª–∞–≤–Ω–∞—è</a>
        <a href="admin.html" class="nav-button active">üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
        <a href="menu.html" class="nav-button">üçî –ú–µ–Ω—é</a>
        <a href="cart.html" class="nav-button">üõí –ö–æ—Ä–∑–∏–Ω–∞</a>
    </nav>

    <main>
        <div class="container">
            <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            <div id="adminAccessDenied" class="access-denied" style="display: none;">
                <div class="access-denied-content">
                    <h2>üö´ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω</h2>
                    <p>–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.</p>
                    <a href="index.html" class="btn-primary">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                </div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            <div id="adminContent" style="display: none;">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <section class="admin-stats-section">
                    <h1>üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
                    <div class="admin-stats-grid">
                        <div class="admin-stat-card">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-info">
                                <span class="stat-number" id="totalUsers">0</span>
                                <span class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
                            </div>
                        </div>
                        <div class="admin-stat-card">
                            <div class="stat-icon">üéâ</div>
                            <div class="stat-info">
                                <span class="stat-number" id="activePromotionsCount">0</span>
                                <span class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∞–∫—Ü–∏–π</span>
                            </div>
                        </div>
                        <div class="admin-stat-card">
                            <div class="stat-icon">üõí</div>
                            <div class="stat-info">
                                <span class="stat-number" id="totalOrders">0</span>
                                <span class="stat-label">–ó–∞–∫–∞–∑–æ–≤</span>
                            </div>
                        </div>
                        <div class="admin-stat-card">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-info">
                                <span class="stat-number" id="totalRevenue">0 ‚ÇΩ</span>
                                <span class="stat-label">–û–±—â–∏–π –¥–æ—Ö–æ–¥</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ü–∏—è–º–∏ -->
                <section class="admin-section">
                    <div class="section-header">
                        <h2>üéâ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ü–∏—è–º–∏</h2>
                        <button class="btn-primary" onclick="togglePromotionForm()" id="toggleFormBtn">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ü–∏—é
                        </button>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ü–∏–∏ -->
                    <div id="promotionFormContainer" class="form-container" style="display: none;">
                        <form id="promotionForm" class="admin-form">
                            <input type="hidden" id="editingPromotionId" value="">
                            
                            <div class="form-group">
                                <label for="promotionTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ü–∏–∏ *</label>
                                <input type="text" id="promotionTitle" required maxlength="100" 
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ü–∏–∏">
                            </div>
                            
                            <div class="form-group">
                                <label for="promotionDescription">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                                <textarea id="promotionDescription" rows="3" required maxlength="500" 
                                          placeholder="–û–ø–∏—à–∏—Ç–µ –∞–∫—Ü–∏—é"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="promotionImage">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                                <input type="url" id="promotionImage" 
                                       placeholder="https://example.com/image.jpg">
                                <small class="form-hint">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</small>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="promotionStartDate">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ *</label>
                                    <input type="date" id="promotionStartDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="promotionEndDate">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è *</label>
                                    <input type="date" id="promotionEndDate" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="promotionStatus">–°—Ç–∞—Ç—É—Å –∞–∫—Ü–∏–∏</label>
                                <select id="promotionStatus">
                                    <option value="active">–ê–∫—Ç–∏–≤–Ω–∞—è</option>
                                    <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω–∞—è</option>
                                    <option value="scheduled">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è</option>
                                </select>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="submit-btn" id="submitPromotionBtn">
                                    üéâ –î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ü–∏—é
                                </button>
                                <button type="button" class="btn-secondary" onclick="cancelEditing()">
                                    ‚ùå –û—Ç–º–µ–Ω–∞
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –∞–∫—Ü–∏–π -->
                    <div class="promotions-management">
                        <h3>üìã –°–ø–∏—Å–æ–∫ –∞–∫—Ü–∏–π</h3>
                        <div class="management-controls">
                            <div class="search-box">
                                <input type="text" id="promotionSearch" placeholder="–ü–æ–∏—Å–∫ –∞–∫—Ü–∏–π..." 
                                       onkeyup="filterPromotions()">
                            </div>
                            <div class="filter-controls">
                                <select id="statusFilter" onchange="filterPromotions()">
                                    <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                    <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                                    <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                                    <option value="scheduled">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="promotionsList" class="promotions-list">
                            <div class="loading-message">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ü–∏–π...</div>
                        </div>
                    </div>
                </section>

                <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ü–∏–π -->
                <section class="admin-section">
                    <h3>üëÄ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ü–∏–π</h3>
                    <p>–¢–∞–∫ –∞–∫—Ü–∏–∏ –≤–∏–¥—è—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</p>
                    <div id="promotionsPreview" class="promotions-container">
                        <!-- –ê–∫—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </div>
                </section>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>üîß –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –∏ –∞–∫—Ü–∏—è–º–∏</p>
            </div>
            <div class="footer-section">
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: <span id="footerUsersCount">0</span></p>
                <p>–ê–∫—Ü–∏–π: <span id="footerPromotionsCount">0</span></p>
            </div>
            <div class="footer-copyright">
                <p>&copy; 2025 –ü–µ—Ä–µ–∫—É—Å–æ–Ω. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å v1.0.0</p>
            </div>
        </div>
    </footer>
    
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
    <script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        checkAdminAccess();
        initializeAdminPage();
    });

    function checkAdminAccess() {
        const adminContent = document.getElementById('adminContent');
        const accessDenied = document.getElementById('adminAccessDenied');
        
        if (typeof authSystem !== 'undefined' && authSystem.isAdmin()) {
            adminContent.style.display = 'block';
            accessDenied.style.display = 'none';
        } else {
            adminContent.style.display = 'none';
            accessDenied.style.display = 'block';
        }
    }

    function initializeAdminPage() {
        if (typeof authSystem === 'undefined' || !authSystem.isAdmin()) return;
        
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ adminManager
        const checkAdminManager = setInterval(() => {
            if (typeof adminManager !== 'undefined') {
                clearInterval(checkAdminManager);
                loadAdminStats();
                adminManager.loadPromotions();
                setupEventListeners();
                console.log('–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            }
        }, 100);

        // –¢–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ adminManager –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
        setTimeout(() => {
            clearInterval(checkAdminManager);
            if (typeof adminManager === 'undefined') {
                console.error('adminManager –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                showAdminMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏', 'error');
            }
        }, 5000);
    }

    function loadAdminStats() {
        if (authSystem.getStats) {
            const stats = authSystem.getStats();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
            document.getElementById('activePromotionsCount').textContent = stats.activePromotions || 0;
            document.getElementById('totalOrders').textContent = stats.totalOrders || 0;
            document.getElementById('totalRevenue').textContent = (stats.totalRevenue || 0).toLocaleString('ru-RU') + ' ‚ÇΩ';
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ñ—É—Ç–µ—Ä–µ
            document.getElementById('footerUsersCount').textContent = stats.totalUsers || 0;
            document.getElementById('footerPromotionsCount').textContent = stats.activePromotions || 0;
        }
    }

    function setupEventListeners() {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        const promotionForm = document.getElementById('promotionForm');
        if (promotionForm) {
            promotionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                handlePromotionSubmit();
            });
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        setDefaultDates();
    }

    function setDefaultDates() {
        const today = new Date().toISOString().split('T')[0];
        const nextWeek = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
        
        const startDateInput = document.getElementById('promotionStartDate');
        const endDateInput = document.getElementById('promotionEndDate');
        
        if (startDateInput && !startDateInput.value) startDateInput.value = today;
        if (endDateInput && !endDateInput.value) endDateInput.value = nextWeek;
    }

    function togglePromotionForm() {
        const formContainer = document.getElementById('promotionFormContainer');
        const toggleBtn = document.getElementById('toggleFormBtn');
        
        if (formContainer.style.display === 'none') {
            formContainer.style.display = 'block';
            toggleBtn.textContent = 'üëÅÔ∏è –°–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É';
            cancelEditing(); // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        } else {
            formContainer.style.display = 'none';
            toggleBtn.textContent = '‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ü–∏—é';
        }
    }

    function handlePromotionSubmit() {
        if (typeof adminManager === 'undefined') {
            showAdminMessage('–ú–µ–Ω–µ–¥–∂–µ—Ä –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
            return;
        }

        const editingId = document.getElementById('editingPromotionId').value;
        
        if (editingId) {
            adminManager.updatePromotion(editingId);
        } else {
            adminManager.addPromotion();
        }
    }

    function editPromotion(promotionId) {
        if (typeof adminManager === 'undefined') {
            showAdminMessage('–ú–µ–Ω–µ–¥–∂–µ—Ä –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
            return;
        }
        adminManager.editPromotion(promotionId);
    }

    function cancelEditing() {
        if (typeof adminManager === 'undefined') {
            showAdminMessage('–ú–µ–Ω–µ–¥–∂–µ—Ä –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
            return;
        }
        adminManager.cancelEditing();
    }

    function filterPromotions() {
        if (typeof adminManager === 'undefined') {
            showAdminMessage('–ú–µ–Ω–µ–¥–∂–µ—Ä –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
            return;
        }
        adminManager.filterPromotions();
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
    function logout() {
        if (authSystem && authSystem.logout) {
            authSystem.logout();
            window.location.href = 'index.html';
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
    function showAdminMessage(message, type = 'success') {
        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é showMessage –∏–∑ auth.js
        if (typeof window.showMessage === 'function' && window.showMessage !== showAdminMessage) {
            window.showMessage(message, type);
            return;
        }

        // Fallback –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        let messageElement = document.getElementById('adminMessage');
        if (!messageElement) {
            messageElement = document.createElement('div');
            messageElement.id = 'adminMessage';
            messageElement.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            document.body.appendChild(messageElement);
        }

        const styles = {
            success: { background: '#28a745' },
            error: { background: '#dc3545' },
            warning: { background: '#ffc107', color: '#212529' },
            info: { background: '#17a2b8' }
        };

        Object.assign(messageElement.style, styles[type] || styles.success);
        messageElement.textContent = message;
        messageElement.style.display = 'block';
        
        setTimeout(() => {
            messageElement.style.display = 'none';
        }, 5000);
    }
	</script>
</body>
</html>
